import type { AuditAction, AuditScope } from "@prisma/client";

export const AUDIT_SCOPE = {
  PERSONAL: "PERSONAL",
  TEAM: "TEAM",
} as const satisfies Record<AuditScope, AuditScope>;

export const AUDIT_ACTION = {
  AUTH_LOGIN: "AUTH_LOGIN",
  AUTH_LOGOUT: "AUTH_LOGOUT",
  ENTRY_BULK_TRASH: "ENTRY_BULK_TRASH",
  ENTRY_EMPTY_TRASH: "ENTRY_EMPTY_TRASH",
  ENTRY_BULK_ARCHIVE: "ENTRY_BULK_ARCHIVE",
  ENTRY_BULK_UNARCHIVE: "ENTRY_BULK_UNARCHIVE",
  ENTRY_BULK_RESTORE: "ENTRY_BULK_RESTORE",
  ENTRY_IMPORT: "ENTRY_IMPORT",
  ENTRY_CREATE: "ENTRY_CREATE",
  ENTRY_UPDATE: "ENTRY_UPDATE",
  ENTRY_DELETE: "ENTRY_DELETE",
  ENTRY_TRASH: "ENTRY_TRASH",
  ENTRY_PERMANENT_DELETE: "ENTRY_PERMANENT_DELETE",
  ENTRY_RESTORE: "ENTRY_RESTORE",
  ENTRY_EXPORT: "ENTRY_EXPORT",
  ATTACHMENT_UPLOAD: "ATTACHMENT_UPLOAD",
  ATTACHMENT_DELETE: "ATTACHMENT_DELETE",
  TEAM_MEMBER_INVITE: "TEAM_MEMBER_INVITE",
  TEAM_MEMBER_REMOVE: "TEAM_MEMBER_REMOVE",
  TEAM_ROLE_UPDATE: "TEAM_ROLE_UPDATE",
  SHARE_CREATE: "SHARE_CREATE",
  SHARE_REVOKE: "SHARE_REVOKE",
  SEND_CREATE: "SEND_CREATE",
  SEND_REVOKE: "SEND_REVOKE",
  EMERGENCY_GRANT_CREATE: "EMERGENCY_GRANT_CREATE",
  EMERGENCY_GRANT_ACCEPT: "EMERGENCY_GRANT_ACCEPT",
  EMERGENCY_GRANT_REJECT: "EMERGENCY_GRANT_REJECT",
  EMERGENCY_GRANT_CONFIRM: "EMERGENCY_GRANT_CONFIRM",
  EMERGENCY_ACCESS_REQUEST: "EMERGENCY_ACCESS_REQUEST",
  EMERGENCY_ACCESS_ACTIVATE: "EMERGENCY_ACCESS_ACTIVATE",
  EMERGENCY_ACCESS_REVOKE: "EMERGENCY_ACCESS_REVOKE",
  EMERGENCY_VAULT_ACCESS: "EMERGENCY_VAULT_ACCESS",
  VAULT_UNLOCK_FAILED: "VAULT_UNLOCK_FAILED",
  VAULT_LOCKOUT_TRIGGERED: "VAULT_LOCKOUT_TRIGGERED",
  RECOVERY_KEY_CREATED: "RECOVERY_KEY_CREATED",
  RECOVERY_KEY_REGENERATED: "RECOVERY_KEY_REGENERATED",
  RECOVERY_PASSPHRASE_RESET: "RECOVERY_PASSPHRASE_RESET",
  VAULT_RESET_EXECUTED: "VAULT_RESET_EXECUTED",
  FOLDER_CREATE: "FOLDER_CREATE",
  FOLDER_UPDATE: "FOLDER_UPDATE",
  FOLDER_DELETE: "FOLDER_DELETE",
  ENTRY_HISTORY_RESTORE: "ENTRY_HISTORY_RESTORE",
  HISTORY_PURGE: "HISTORY_PURGE",
  MASTER_KEY_ROTATION: "MASTER_KEY_ROTATION",
  SESSION_REVOKE: "SESSION_REVOKE",
  SESSION_REVOKE_ALL: "SESSION_REVOKE_ALL",
  TEAM_E2E_MIGRATION: "TEAM_E2E_MIGRATION",
  TEAM_KEY_ROTATION: "TEAM_KEY_ROTATION",
  TEAM_MEMBER_KEY_DISTRIBUTE: "TEAM_MEMBER_KEY_DISTRIBUTE",
  SCIM_TOKEN_CREATE: "SCIM_TOKEN_CREATE",
  SCIM_TOKEN_REVOKE: "SCIM_TOKEN_REVOKE",
  SCIM_USER_CREATE: "SCIM_USER_CREATE",
  SCIM_USER_UPDATE: "SCIM_USER_UPDATE",
  SCIM_USER_DEACTIVATE: "SCIM_USER_DEACTIVATE",
  SCIM_USER_REACTIVATE: "SCIM_USER_REACTIVATE",
  SCIM_USER_DELETE: "SCIM_USER_DELETE",
  SCIM_GROUP_UPDATE: "SCIM_GROUP_UPDATE",
} as const satisfies Record<AuditAction, AuditAction>;

export type AuditScopeValue =
  (typeof AUDIT_SCOPE)[keyof typeof AUDIT_SCOPE];

export type AuditActionValue =
  (typeof AUDIT_ACTION)[keyof typeof AUDIT_ACTION];

export const AUDIT_ACTION_VALUES = [
  AUDIT_ACTION.AUTH_LOGIN,
  AUDIT_ACTION.AUTH_LOGOUT,
  AUDIT_ACTION.ENTRY_BULK_TRASH,
  AUDIT_ACTION.ENTRY_EMPTY_TRASH,
  AUDIT_ACTION.ENTRY_BULK_ARCHIVE,
  AUDIT_ACTION.ENTRY_BULK_UNARCHIVE,
  AUDIT_ACTION.ENTRY_BULK_RESTORE,
  AUDIT_ACTION.ENTRY_IMPORT,
  AUDIT_ACTION.ENTRY_CREATE,
  AUDIT_ACTION.ENTRY_UPDATE,
  AUDIT_ACTION.ENTRY_DELETE,
  AUDIT_ACTION.ENTRY_TRASH,
  AUDIT_ACTION.ENTRY_PERMANENT_DELETE,
  AUDIT_ACTION.ENTRY_RESTORE,
  AUDIT_ACTION.ENTRY_EXPORT,
  AUDIT_ACTION.ATTACHMENT_UPLOAD,
  AUDIT_ACTION.ATTACHMENT_DELETE,
  AUDIT_ACTION.TEAM_MEMBER_INVITE,
  AUDIT_ACTION.TEAM_MEMBER_REMOVE,
  AUDIT_ACTION.TEAM_ROLE_UPDATE,
  AUDIT_ACTION.SHARE_CREATE,
  AUDIT_ACTION.SHARE_REVOKE,
  AUDIT_ACTION.EMERGENCY_GRANT_CREATE,
  AUDIT_ACTION.EMERGENCY_GRANT_ACCEPT,
  AUDIT_ACTION.EMERGENCY_GRANT_REJECT,
  AUDIT_ACTION.EMERGENCY_GRANT_CONFIRM,
  AUDIT_ACTION.EMERGENCY_ACCESS_REQUEST,
  AUDIT_ACTION.EMERGENCY_ACCESS_ACTIVATE,
  AUDIT_ACTION.EMERGENCY_ACCESS_REVOKE,
  AUDIT_ACTION.EMERGENCY_VAULT_ACCESS,
  AUDIT_ACTION.VAULT_UNLOCK_FAILED,
  AUDIT_ACTION.VAULT_LOCKOUT_TRIGGERED,
  AUDIT_ACTION.RECOVERY_KEY_CREATED,
  AUDIT_ACTION.RECOVERY_KEY_REGENERATED,
  AUDIT_ACTION.RECOVERY_PASSPHRASE_RESET,
  AUDIT_ACTION.VAULT_RESET_EXECUTED,
  AUDIT_ACTION.FOLDER_CREATE,
  AUDIT_ACTION.FOLDER_UPDATE,
  AUDIT_ACTION.FOLDER_DELETE,
  AUDIT_ACTION.ENTRY_HISTORY_RESTORE,
  AUDIT_ACTION.HISTORY_PURGE,
  AUDIT_ACTION.SEND_CREATE,
  AUDIT_ACTION.SEND_REVOKE,
  AUDIT_ACTION.MASTER_KEY_ROTATION,
  AUDIT_ACTION.SESSION_REVOKE,
  AUDIT_ACTION.SESSION_REVOKE_ALL,
  AUDIT_ACTION.TEAM_E2E_MIGRATION,
  AUDIT_ACTION.TEAM_KEY_ROTATION,
  AUDIT_ACTION.TEAM_MEMBER_KEY_DISTRIBUTE,
  AUDIT_ACTION.SCIM_TOKEN_CREATE,
  AUDIT_ACTION.SCIM_TOKEN_REVOKE,
  AUDIT_ACTION.SCIM_USER_CREATE,
  AUDIT_ACTION.SCIM_USER_UPDATE,
  AUDIT_ACTION.SCIM_USER_DEACTIVATE,
  AUDIT_ACTION.SCIM_USER_REACTIVATE,
  AUDIT_ACTION.SCIM_USER_DELETE,
  AUDIT_ACTION.SCIM_GROUP_UPDATE,
] as const;

export const AUDIT_ACTION_GROUP = {
  AUTH: "group:auth",
  ENTRY: "group:entry",
  BULK: "group:bulk",
  TRANSFER: "group:transfer",
  ATTACHMENT: "group:attachment",
  FOLDER: "group:folder",
  HISTORY: "group:history",
  TEAM: "group:team",
  SHARE: "group:share",
  SEND: "group:send",
  EMERGENCY: "group:emergency",
  ADMIN: "group:admin",
  SCIM: "group:scim",
} as const;

export const AUDIT_ACTION_GROUPS_PERSONAL: Record<string, AuditAction[]> = {
  [AUDIT_ACTION_GROUP.AUTH]: [
    AUDIT_ACTION.AUTH_LOGIN,
    AUDIT_ACTION.AUTH_LOGOUT,
    AUDIT_ACTION.VAULT_UNLOCK_FAILED,
    AUDIT_ACTION.VAULT_LOCKOUT_TRIGGERED,
    AUDIT_ACTION.RECOVERY_KEY_CREATED,
    AUDIT_ACTION.RECOVERY_KEY_REGENERATED,
    AUDIT_ACTION.RECOVERY_PASSPHRASE_RESET,
    AUDIT_ACTION.VAULT_RESET_EXECUTED,
    AUDIT_ACTION.SESSION_REVOKE,
    AUDIT_ACTION.SESSION_REVOKE_ALL,
  ],
  [AUDIT_ACTION_GROUP.ENTRY]: [
    AUDIT_ACTION.ENTRY_CREATE,
    AUDIT_ACTION.ENTRY_UPDATE,
    AUDIT_ACTION.ENTRY_TRASH,
    AUDIT_ACTION.ENTRY_PERMANENT_DELETE,
    AUDIT_ACTION.ENTRY_RESTORE,
  ],
  [AUDIT_ACTION_GROUP.BULK]: [
    AUDIT_ACTION.ENTRY_BULK_TRASH,
    AUDIT_ACTION.ENTRY_EMPTY_TRASH,
    AUDIT_ACTION.ENTRY_BULK_ARCHIVE,
    AUDIT_ACTION.ENTRY_BULK_UNARCHIVE,
    AUDIT_ACTION.ENTRY_BULK_RESTORE,
  ],
  [AUDIT_ACTION_GROUP.TRANSFER]: [
    AUDIT_ACTION.ENTRY_IMPORT,
    AUDIT_ACTION.ENTRY_EXPORT,
  ],
  [AUDIT_ACTION_GROUP.ATTACHMENT]: [
    AUDIT_ACTION.ATTACHMENT_UPLOAD,
    AUDIT_ACTION.ATTACHMENT_DELETE,
  ],
  [AUDIT_ACTION_GROUP.TEAM]: [
    AUDIT_ACTION.TEAM_MEMBER_INVITE,
    AUDIT_ACTION.TEAM_MEMBER_REMOVE,
    AUDIT_ACTION.TEAM_ROLE_UPDATE,
  ],
  [AUDIT_ACTION_GROUP.FOLDER]: [
    AUDIT_ACTION.FOLDER_CREATE,
    AUDIT_ACTION.FOLDER_UPDATE,
    AUDIT_ACTION.FOLDER_DELETE,
  ],
  [AUDIT_ACTION_GROUP.HISTORY]: [
    AUDIT_ACTION.ENTRY_HISTORY_RESTORE,
    AUDIT_ACTION.HISTORY_PURGE,
  ],
  [AUDIT_ACTION_GROUP.SHARE]: [
    AUDIT_ACTION.SHARE_CREATE,
    AUDIT_ACTION.SHARE_REVOKE,
  ],
  [AUDIT_ACTION_GROUP.SEND]: [
    AUDIT_ACTION.SEND_CREATE,
    AUDIT_ACTION.SEND_REVOKE,
  ],
  [AUDIT_ACTION_GROUP.EMERGENCY]: [
    AUDIT_ACTION.EMERGENCY_GRANT_CREATE,
    AUDIT_ACTION.EMERGENCY_GRANT_ACCEPT,
    AUDIT_ACTION.EMERGENCY_GRANT_REJECT,
    AUDIT_ACTION.EMERGENCY_GRANT_CONFIRM,
    AUDIT_ACTION.EMERGENCY_ACCESS_REQUEST,
    AUDIT_ACTION.EMERGENCY_ACCESS_ACTIVATE,
    AUDIT_ACTION.EMERGENCY_ACCESS_REVOKE,
    AUDIT_ACTION.EMERGENCY_VAULT_ACCESS,
  ],
};

export const AUDIT_ACTION_GROUPS_TEAM: Record<string, AuditAction[]> = {
  [AUDIT_ACTION_GROUP.ENTRY]: [
    AUDIT_ACTION.ENTRY_CREATE,
    AUDIT_ACTION.ENTRY_UPDATE,
    AUDIT_ACTION.ENTRY_TRASH,
    AUDIT_ACTION.ENTRY_PERMANENT_DELETE,
    AUDIT_ACTION.ENTRY_RESTORE,
  ],
  [AUDIT_ACTION_GROUP.BULK]: [
    AUDIT_ACTION.ENTRY_BULK_TRASH,
    AUDIT_ACTION.ENTRY_EMPTY_TRASH,
    AUDIT_ACTION.ENTRY_BULK_ARCHIVE,
    AUDIT_ACTION.ENTRY_BULK_UNARCHIVE,
    AUDIT_ACTION.ENTRY_BULK_RESTORE,
  ],
  [AUDIT_ACTION_GROUP.TRANSFER]: [AUDIT_ACTION.ENTRY_EXPORT],
  [AUDIT_ACTION_GROUP.ATTACHMENT]: [
    AUDIT_ACTION.ATTACHMENT_UPLOAD,
    AUDIT_ACTION.ATTACHMENT_DELETE,
  ],
  [AUDIT_ACTION_GROUP.FOLDER]: [
    AUDIT_ACTION.FOLDER_CREATE,
    AUDIT_ACTION.FOLDER_UPDATE,
    AUDIT_ACTION.FOLDER_DELETE,
  ],
  [AUDIT_ACTION_GROUP.HISTORY]: [
    AUDIT_ACTION.ENTRY_HISTORY_RESTORE,
    AUDIT_ACTION.HISTORY_PURGE,
  ],
  [AUDIT_ACTION_GROUP.TEAM]: [
    AUDIT_ACTION.TEAM_MEMBER_INVITE,
    AUDIT_ACTION.TEAM_MEMBER_REMOVE,
    AUDIT_ACTION.TEAM_ROLE_UPDATE,
  ],
  [AUDIT_ACTION_GROUP.SHARE]: [
    AUDIT_ACTION.SHARE_CREATE,
    AUDIT_ACTION.SHARE_REVOKE,
  ],
  [AUDIT_ACTION_GROUP.ADMIN]: [
    AUDIT_ACTION.MASTER_KEY_ROTATION,
    AUDIT_ACTION.TEAM_E2E_MIGRATION,
    AUDIT_ACTION.TEAM_KEY_ROTATION,
    AUDIT_ACTION.TEAM_MEMBER_KEY_DISTRIBUTE,
  ],
  [AUDIT_ACTION_GROUP.SCIM]: [
    AUDIT_ACTION.SCIM_TOKEN_CREATE,
    AUDIT_ACTION.SCIM_TOKEN_REVOKE,
    AUDIT_ACTION.SCIM_USER_CREATE,
    AUDIT_ACTION.SCIM_USER_UPDATE,
    AUDIT_ACTION.SCIM_USER_DEACTIVATE,
    AUDIT_ACTION.SCIM_USER_REACTIVATE,
    AUDIT_ACTION.SCIM_USER_DELETE,
    AUDIT_ACTION.SCIM_GROUP_UPDATE,
  ],
};

export const AUDIT_METADATA_KEY = {
  HISTORY_ID: "historyId",
  RESTORED_FROM_CHANGED_AT: "restoredFromChangedAt",
  PURGED_COUNT: "purgedCount",
} as const;

export const AUDIT_ACTION_EMERGENCY_PREFIX = "EMERGENCY_";
